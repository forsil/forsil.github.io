#+TITLE:       给 Synology 配置 Aria2
#+AUTHOR:      forsil
#+EMAIL:       forsil.9@gmail.com
#+DATE:        2016-09-28 Wed
#+URI:         /blog/%y/%m/%d/给-synology-配置-aria2
#+KEYWORDS:    Synology, aria2, webui, docker
#+TAGS:        Synology, aria2, webui, docker
#+LANGUAGE:    en
#+OPTIONS:     H:3 num:nil toc:nil \n:nil ::t |:t ^:nil -:nil f:t *:t <:t
#+DESCRIPTION: 在 DSM 系统中通过 docker 添加 aria2 支持

* 安装 Docker
  如果下载速度慢，可以挂个 http 代理。
  操作面板->网络->代理服务器

* 安装包含 aria2 和 webui 的 Docker 镜像
  我用的是 joshua7v/webui-aria2，该镜像既包含了 aria2，也包含了 webui。

* 做端口映射
  6800:6800
  10080:8080

* 启动镜像，修改 Procfile
  Procfile 中记录了开机启动的代码。

  原始代码：
  #+BEGIN_SRC sh
  -e web: gosu dummy /bin/busybox httpd -f -p 8080 -h /webui-aria2
  backend: gosu dummy /usr/bin/aria2c --enable-rpc --rpc-listen-all --dir=/data
  #+END_SRC

  修改后的代码
  #+BEGIN_SRC sh
  -e web: gosu dummy /bin/busybox httpd -f -p 8080 -h /webui-aria2
  backend: gosu dummy /usr/bin/aria2c --enable-rpc --rpc-listen-all --rpc-allow-origin-all --dir=/data --rpc-secret 12345
  #+END_SRC

  添加 --rpc-allow-origin-all 是为了能够让浏览器有跨域权限。
  添加 --rpc-secret 是使用 token 来做授权处理。

* 检验结果
  打开 <synology ip/domain :10080>，然后看看能不能下载。如果碰到不能下载，提示是无法创建文件的错误，原因可能是下载文件夹的权限不够，可以使用一下命令修改文件夹权限：
  #+BEGIN_SRC sh
  chmod 777 </path/to/download folder>
  #+END_SRC
